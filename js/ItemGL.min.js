/**
* The ItemGL plugin implements an application that
* simply lets the user customize an item using WebGL and ThreeJs.
*
* @author  Llogari Casas
* @version 1.0
* @since   2015-02-21 
*/

(function(c){var b=c.extend({id:"canvas",width:960,height:540,clearColor:15658734,btnLeft:c("#btnPrevious"),btnRight:c("#btnNext"),imagesLeather:(".imageWood"),imagesWood:(".imageWood"),core:{object:[],renderer:null,camera:null,scene:null,light:null,canvas:null,spotLight:null,group:null,interval:null},items:{wood:null,leather:null},geometry:{ground:null,cube:null},numObj:7,objGeometry:[{x:15,y:1,z:15},{x:2,y:16,z:2},{x:2,y:16,z:2},{x:2,y:32,z:2},{x:2,y:32,z:2},{x:12,y:3,z:1},{x:12,y:3,z:1}],objPosition:[{x:8,y:6,z:3},{x:1,y:-2,z:10},{x:15,y:-2,z:10},{x:1,y:6,z:-5},{x:15,y:6,z:-5},{x:8,y:20,z:-5},{x:8,y:15,z:-5}],objType:["Leather","Wood","Wood","Wood","Wood","Leather","Leather"]},b);var a={init:function(f){if(typeof f==="object"){c.extend(f,this.options)}b.core.scene=new THREE.Scene();b.core.camera=new THREE.PerspectiveCamera(50,b.width/b.height,0.1,1000);b.core.renderer=new THREE.WebGLRenderer();b.core.renderer.setClearColor(new THREE.Color(15658734,1));b.core.renderer.setSize(b.width,b.height);b.core.renderer.shadowMapEnabled=true;b.core.group=new THREE.Object3D();var g=a.computeOffset();for(var e=0;e<b.numObj;e++){var d=new THREE.BoxGeometry(b.objGeometry[e].x,b.objGeometry[e].y,b.objGeometry[e].z);b.core.object[e]=a.addMaterial(d,"images/Resources/UVMap.png");b.core.object[e].receiveShadow=true;b.core.object[e].position.x=b.objPosition[e].x-g.x;b.core.object[e].position.y=b.objPosition[e].y-g.y;b.core.object[e].position.z=b.objPosition[e].z-g.z;b.core.group.add(b.core.object[e])}b.core.group.applyMatrix(new THREE.Matrix4().makeTranslation(g.x,g.y,g.z));b.core.scene.add(b.core.group);b.core.camera.position.x=10;b.core.camera.position.y=30;b.core.camera.position.z=60;b.core.camera.lookAt(new THREE.Vector3(10,0,0));b.core.light=new THREE.AmbientLight(789516);b.core.scene.add(b.core.light);b.core.spotLight=new THREE.SpotLight(16777215);b.core.spotLight.position.set(-30,60,60);b.core.spotLight.castShadow=true;b.core.scene.add(b.core.spotLight);c("#"+b.id).append(b.core.renderer.domElement);a.render();a.setupButtons();b.core.renderer.render(b.core.scene,b.core.camera)},setupButtons:function(){b.btnLeft.hover(function(){b.core.interval=window.setInterval(function(){b.core.group.rotation.y+=0.05;b.core.renderer.render(b.core.scene,b.core.camera)},15)},function(){window.clearInterval(b.core.interval)});b.btnRight.hover(function(){b.core.interval=window.setInterval(function(){b.core.group.rotation.y-=0.05;b.core.renderer.render(b.core.scene,b.core.camera)},15)},function(){window.clearInterval(b.core.interval)})},computeOffset:function(){var h={x:0,y:0,z:0};var g={x:0,y:0,z:0};var e={x:0,y:0,z:0};for(var f=0;f<b.objPosition.length;f++){var d=b.objPosition[f];if(d.x>h.x){h.x=d.x}else{if(d.x<g.x){g.x=d.x}}if(d.y>h.y){h.y=d.y}else{if(d.y<g.y){g.y=d.y}}if(d.z>h.z){h.z=d.z}else{if(d.z<g.z){g.z=d.z}}}e.x=g.x+(h.x-g.x)/2;e.y=g.y+(h.y-g.y)/2;e.z=g.z+(h.z-g.z)/2;return e},render:function(){requestAnimationFrame(a.render);b.core.renderer.render(b.core.scene,b.core.camera)},changeItem:function(e,g){var f=THREE.ImageUtils.loadTexture(g.firstChild.src);for(var d=0;d<b.numObj;d++){if(b.objType[d]==e){b.core.object[d].material.map=f}}},addMaterial:function(e,g){var f=THREE.ImageUtils.loadTexture(g);var d=new THREE.MeshPhongMaterial();d.map=f;d.needsUpdate=true;var h=new THREE.Mesh(e,d);return h}};c.fn.ItemGL=function(d){if(typeof d==="undefined"){d="init"}if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{c.error("Method "+d+" does not exist on jQuery")}}}})(jQuery);
